@startuml
title UC-07 Scenario 4: Enable/Disable Review - Design Level Sequence Diagram

actor Employee
participant "Admin Dashboard UI (React)" as UI <<Boundary>>
control ReviewController <<Control>>
participant ReviewService <<Service>>
participant AuthService <<Service>>
database Database

== Authentication & Authorization Check ==

Employee -> UI : toggleReviewStatus(reviewId, enabledFlag)
UI -> AuthService : hasRole("EMPLOYEE")

alt Not Authorized (Exception A2/A3)
    AuthService --> UI : false
    UI --> Employee : Error: "Insufficient Permissions"
else Authorized
    AuthService --> UI : true
    UI -> ReviewController : patchReviewStatus(reviewId, enabledFlag)

    == Processing Toggle Request ==

    ReviewController -> ReviewService : toggleReviewEnabled(reviewId, enabledFlag)

    ReviewService -> Database : findReviewById(reviewId)

    alt Review Not Found (Exception A1)
        Database --> ReviewService : null
        ReviewService --> ReviewController : error("Review not found")
        ReviewController --> UI : error("Review not found")
        UI --> Employee : "Review not found"
    else Review Exists
        Database --> ReviewService : reviewData

        ReviewService -> Database : updateEnabledStatus(reviewId, enabledFlag)
        Database --> ReviewService : updatedReviewData

        ReviewService --> ReviewController : updatedReviewDTO
        ReviewController --> UI : 200 OK (updatedReviewDTO)

        alt Status Set to False
            UI --> Employee : "Confirmation: Review is now DISABLED"
        else Status Set to True
            UI --> Employee : "Confirmation: Review is now ENABLED"
        end
    end
end

== Public Visibility Verification ==

actor Customer
Customer -> UI : getProductReviews(productId)
UI -> ReviewService : getEnabledReviews(productId)
ReviewService -> Database : fetchReviewsByStatus(productId, enabled=true)
Database --> ReviewService : filteredReviewList
ReviewService --> UI : filteredReviewList
UI --> Customer : Display only enabled reviews

@enduml